dim_ABC;"
Aggr
(
    {<[Номенклатура] =>} 
    If
    (
        $(exp_ДоляПоказатель1) <= ($(vПорог_А)/100)
        , 'A'
        ,If
        (
            $(exp_ДоляПоказатель1) <= ($(vПорог_В)/100)
            , 'B'
            , 'C'
        )
    )
    , $(exp_Измерение)
)
"
dim_ABC2;"
Aggr
(
    {<[Номенклатура]=>} 
    If
    (
        (
            Rangesum
            (
                Above
                (
                    Aggr($(exp_Показатель), $(exp_Измерение)) 
                    / 
                    Aggr($(exp_Показатель_total), $(exp_Измерение))
                    , 0, RowNo()
                )
            )
        ) <= $(vA)
        , 'A'
        ,If
        (
            (
                Rangesum
                (
                    Above
                    (
                        Aggr($(exp_Показатель), $(exp_Измерение)) 
                        / 
                        Aggr($(exp_Показатель_total), $(exp_Измерение))
                        , 0, RowNo()
                    )
                )
            ) <= $(vB)
            , 'B'
            , 'C'
        )
    )
    , $(exp_Измерение)
)
"
dim_Calendar.МесяцГод;"Дата.Calendar.МесяцГод"
dim_Calendar.НеделяГод;"Дата.Calendar.НеделяГод"
dim_ДнейНаСкладе;"Ceil([Дней на складе], 20)"
dim_ДниОстатки;"If(Sum({<Дата = {""=rank(Дата, 4) = 1""}>} Остаток) > 0, [Дней на складе])"
dim_МесяцГодПостуления;"MonthName([ДатаПоступления])//"
dim_НаценкаОстатков;"
Num
(
    Ceil
    (
        Aggr
        (
            (
                (
                    (
                        Sum
                        (
                            Aggr
                            (
                                Sum
                                (
                                    {<Дата = {""=rank(Дата, 4) = 1""}>} 
                                    Остаток 
                                    * 
                                    [6X]
                                )
                                , %СерияОстатка, [Номенклатура], [Категория]
                            )
                        )
                        /
                        Only(total {<Дата = {""=rank(Дата, 4) = 1""}>} [КурсUSD])
                    )
                    +
                    Sum
                    (
                        Aggr
                        (
                            Sum({<$(set_УсловияПродаж)>} СуммаЗащиты)
                            , %СерияОстатка, [Номенклатура], [Категория]
                        )
                    )
                    +
                    Sum
                    (
                        Aggr
                        (
                            Sum
                            (
                                {<$(set_УсловияПродаж)>} 
                                [СуммаВозвратаНДС]
                                *
                                [Продано штук]
                            )
                            , %СерияОстатка, [Номенклатура], [Категория]
                        )
                    )
                    -
                    Sum
                    (
                        Aggr
                        (
                            Sum
                            (
                                {<Дата = {""=rank(Дата, 4) = 1""}>} 
                                Остаток 
                                * 
                                [ПерваяСебОстатка]
                            )
                            , %СерияОстатка, [Номенклатура], Категория
                        )
                    )
                )
                /
                Sum
                (
                    Aggr
                    (
                        Sum
                        (
                            {<Дата = {""=rank(Дата, 4) = 1""}>} 
                            Остаток 
                            * 
                            [ПерваяСебОстатка]
                        )
                        , %СерияОстатка, [Номенклатура], Категория
                    )
                )
            )
            , %СерияОстатка
        )
        , 0.05
    )
    , '# ##0%', ',', ' '
)
"
dim_Номенклатура_Характеристика;"[Номенклатура] & ' ' & [Характеристика]"
dim_НоменклатураОстатка;"
If
(
    Aggr
    (
        Sum({<Дата = {""=rank(Дата, 4) = 1""}>} Остаток)
        , Склад, [Категория], [Номенклатура]
    )
    > 0
    or
    Aggr
    (
        Sum({<Дата = {""=rank(Дата, 4) = 1""}, $(set_УсловияПродаж)>} [Продано штук])
        , Склад, [Категория], [Номенклатура]
    ) 
    > 0
    ,[Номенклатура]
)
"
dim_ОбъемРентабельности;"
If
(
    Aggr($(exp_Наценка), [Контрагент]) >0.1
    , Dual('10%+', 4)
    ,If
    (
        Aggr($(exp_Наценка), [Контрагент]) > 0.05 
        and 
        Aggr($(exp_Наценка), [Контрагент]) <= 0.1
        , Dual('5%-10%', 3)
        ,If
        (
            Aggr($(exp_Наценка), [Контрагент]) >0.01 
            and 
            Aggr($(exp_Наценка), [Контрагент]) <= 0.05
            , Dual('1%-5%', 2)
            , Dual('<1%', 1)
        )
    )
)
"
dim_ОбъемыВыручки;"
If
(
    Aggr
    (
        Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС])
        , [Контрагент]
    ) >10000
    , Dual('10k+', 4)
    ,If
    (
        Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Контрагент]) >5000 
        and 
        Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Контрагент]) <= 10000
        , Dual('5k-10k', 3)
        ,If
        (
            Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Контрагент]) >1000 
            and Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Контрагент]) <= 5000
            , Dual('1k-5k', 2)
            , Dual('<1k', 1)
        )
    )
)
"
dim_МенеджерЗП;"If(Aggr(Sum([ЗП]), [Менеджер]) > 0, [Менеджер])"
dim_ПодразделениеЗП;"If(Aggr(Sum([ЗП]), [Подразделение]) > 0, [Подразделение])"
dim_РейтингОборота;"Class(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]),10000)"
dim_СерияОстатка;"
If
(
    Aggr
    (
        Sum({<Дата = {""=rank(Дата, 4) = 1""}>} Остаток)
        , Склад, [Категория], [Номенклатура], %СерияОстатка
    ) > 0
    or
    Aggr
    (
        Sum({<Дата = {""=rank(Дата, 4) = 1""}, $(set_УсловияПродаж)>} [Продано штук])
        , Склад, [Категория], [Номенклатура], %Серия
    ) > 0,
    %СерияОстатка
)
"
dim_СопутствующиеТовары;"If([Сопутствующие товары] <> [Номенклатура], [Сопутствующие товары])"
dim_СрПроцентРент;"
If
(
    Aggr
    (
        Avg
        (
            Aggr($(exp_Наценка), [МесяцГод], [Контрагент])
        )
        , [Контрагент]
    ) >1.1
    , Dual('11%+', 5)
    ,If
    (
        Aggr
        (
            Avg
            (
                Aggr($(exp_Наценка), [МесяцГод], [Контрагент])
            )
            , [Контрагент]
        ) >0.08 
        and 
        Aggr
        (
            Avg
            (
                Aggr($(exp_Наценка), [МесяцГод], [Контрагент])
            )
            , [Контрагент]
        ) <= 1.1
        , Dual('8%-11%', 4)
        ,If
        (
            Aggr
            (
                Avg
                (
                    Aggr($(exp_Наценка), [МесяцГод], [Контрагент])
                )
                , [Контрагент]
            ) >0.05
            and 
            Aggr
            (
                Avg
                (
                    Aggr($(exp_Наценка), [МесяцГод], [Контрагент])
                )
                , [Контрагент]
            ) <= 0.08
            , Dual('5%-8%', 3)
            ,If
            (
                Aggr
                (
                    Avg
                    (
                        Aggr($(exp_Наценка), [МесяцГод], [Контрагент])
                    )
                    , [Контрагент]
                ) >0.01 
                and 
                Aggr
                (
                    Avg
                    (
                        Aggr($(exp_Наценка), [МесяцГод], [Контрагент])
                    )
                    , [Контрагент]
                ) <= 0.05
                , Dual('1%-5%', 2)
                , Dual('<1%', 1)
            )
        )
    )
)
"
dim_СрПроцентРентПоГодам;"
If
(
    Aggr
    (
        Avg
        (
            Aggr($(exp_Наценка), [Год], [МесяцГод], [Контрагент])
        ), [Год], [Контрагент]
    ) >1.1
    , Dual('11%+', 5)
    ,If
    (
        Aggr
        (
            Avg
            (
                Aggr($(exp_Наценка), [Год], [МесяцГод], [Контрагент])
            ), [Год], [Контрагент]
        ) >0.08 
        and 
        Aggr
        (
            Avg
            (
                Aggr($(exp_Наценка), [Год], [МесяцГод], [Контрагент])
            ), [Год], [Контрагент]
        ) <= 1.1
        , Dual('8%-11%', 4)
        ,If
        (
            Aggr
            (
                Avg
                (
                    Aggr($(exp_Наценка), [Год], [МесяцГод], [Контрагент])
                ), [Год], [Контрагент]
            ) >0.05 
            and 
            Aggr
            (
                Avg
                (
                    Aggr($(exp_Наценка), [Год], [МесяцГод], [Контрагент])
                ), [Год], [Контрагент]
            ) <= 0.08
            , Dual('5%-8%', 3)
            ,If
            (
                Aggr
                (
                    Avg
                    (
                        Aggr($(exp_Наценка), [Год], [МесяцГод], [Контрагент])
                    ), [Год], [Контрагент]
                ) >0.01 
                and 
                Aggr
                (
                    Avg
                    (
                        Aggr($(exp_Наценка), [Год], [МесяцГод], [Контрагент])
                    ), [Год], [Контрагент]
                ) <= 0.05
                , Dual('1%-5%', 2)
                , Dual('<1%', 1)
            )
        )
    )
)
"
dim_СрПроцентРентПоТК;"
If
(
    Aggr
    (
        Avg
        (
            Aggr($(exp_Наценка), [Тип контрагента], [МесяцГод], [Контрагент])
        )
        , [Тип контрагента], [Контрагент]
    ) >0.1
    , Dual('10%+', 4)
    ,If
    (
        Aggr
        (
            Avg
            (
                Aggr($(exp_Наценка), [Тип контрагента], [МесяцГод], [Контрагент])
            )
            , [Тип контрагента], [Контрагент]
        ) >0.05 
        and 
        Aggr
        (
            Avg
            (
                Aggr($(exp_Наценка), [Тип контрагента], [МесяцГод], [Контрагент])
            ), [Тип контрагента], [Контрагент]
        ) <= 0.1
        , Dual('5%-10%', 3)
        ,If
        (
            Aggr
            (
                Avg
                (
                    Aggr($(exp_Наценка), [Тип контрагента], [МесяцГод], [Контрагент])
                )
                , [Тип контрагента], [Контрагент]
            ) >0.01 
            and 
            Aggr
            (
                Avg
                (
                    Aggr($(exp_Наценка), [Тип контрагента], [МесяцГод], [Контрагент])
                )
                , [Тип контрагента], [Контрагент]
            ) <= 0.05
            , Dual('1%-5%', 2)
            , Dual('<1%', 1)
        )
    )
)
"
dim_СрОбъемВыручки;"
If
(
    Aggr
    (
        Avg
        (
            Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Контрагент], [МесяцГод])
        )
        , [Контрагент]
    ) >10000
    , Dual('10k+', 4)
    ,
    If
    (
        Aggr
        (
            Avg
            (
                Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Контрагент], [МесяцГод])
            )
            , [Контрагент]
        ) >5000 
        and 
        Aggr
        (
            Avg
            (
                Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Контрагент], [МесяцГод])
            )
            , [Контрагент]
        ) <= 10000
        , Dual('5k-10k', 3)
        ,If
        (
            Aggr
            (
                Avg
                (
                    Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Контрагент], [МесяцГод])
                )
                , [Контрагент]
            ) >1000 
            and 
            Aggr
            (
                Avg
                (
                    Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Контрагент], [МесяцГод])
                )
                , [Контрагент]
            ) <= 5000
            , Dual('1k-5k', 2)
            , Dual('<1k', 1)
        )
    )
)
"
dim_СрОбъемВыручкиПоГодам;"
If
(
    Aggr
    (
        Avg
        (
            Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Год], [МесяцГод], [Контрагент])
        )
        , [Год], [Контрагент]
    ) >10000
    , Dual('10k+', 4)
    ,If
    (
        Aggr
        (
            Avg
            (
                Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Год], [МесяцГод], [Контрагент])
            )
            , [Год], [Контрагент]
        ) >5000 
        and 
        Aggr
        (
            Avg
            (
                Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Год], [МесяцГод], [Контрагент])
            )
            , [Год], [Контрагент]
        ) <= 10000
        , Dual('5k-10k', 3)
        ,If
        (
            Aggr
            (
                Avg
                (
                    Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Год], [МесяцГод], [Контрагент])
                )
                , [Год], [Контрагент]
            ) >1000 
            and 
            Aggr
            (
                Avg
                (
                    Aggr(Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС]), [Год], [МесяцГод], [Контрагент])
                )
                , [Год], [Контрагент]
            ) <= 5000
            , Dual('1k-5k', 2)
            , Dual('<1k', 1)
        )
    )
)
"
dim_СрСвободныйОстаток;"
If
(
    Aggr
    (
        Avg
        (
            Aggr(Sum({<$(set_УсловияПродаж)>} Остаток - Резерв), [НеделяГод], [Номенклатура])
        )
        , [Номенклатура]
    ) >500
    , Dual('500+', 4)
    ,If
    (
        Aggr
        (
            Avg
            (
                Aggr(Sum({<$(set_УсловияПродаж)>} Остаток - Резерв), [НеделяГод], [Номенклатура])
            )
            , [Номенклатура]
        ) >100 
        and 
        Aggr
        (
            Avg
            (
                Aggr(Sum({<$(set_УсловияПродаж)>} Остаток - Резерв), [НеделяГод], [Номенклатура])
            )
            , [Номенклатура]
        ) <= 500
        , Dual('100-500', 3)
        ,If
        (
            Aggr
            (
                Avg
                (
                    Aggr(Sum({<$(set_УсловияПродаж)>} Остаток - Резерв), [НеделяГод], [Номенклатура])
                )
                , [Номенклатура]
            ) >10 
            and 
            Aggr
            (
                Avg
                (
                    Aggr(Sum({<$(set_УсловияПродаж)>} Остаток - Резерв), [НеделяГод], [Номенклатура])
                )
                , [Номенклатура]
            ) <= 100
            , Dual('10-100', 2)
            , Dual('<10', 1)
        )
    )
)
"
dim_СрЧастотаСделок;"
If
(
    Aggr
    (
        Avg
        (
            Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Контрагент], [МесяцГод])
        )
        ,[Контрагент]
    ) >10
    , Dual('10+', 7),
    If
    (
        Aggr
        (
            Avg
            (
                Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Контрагент], [МесяцГод])
            )
            ,[Контрагент]
        ) >8 
        and 
        Aggr
        (
            Avg
            (
                Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Контрагент], [МесяцГод])
            )
            ,[Контрагент]
        ) <= 10
        , Dual('8-10', 6)
        ,If
        (
            Aggr
            (
                Avg
                (
                    Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Контрагент], [МесяцГод])
                )
                ,[Контрагент]
            ) >4 
            and 
            Aggr
            (
                Avg
                (
                    Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Контрагент], [МесяцГод])
                )
                ,[Контрагент]
            ) <= 8
            , Dual('4-8', 5)
            ,If
            (
                Aggr
                (
                    Avg
                    (
                        Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Контрагент], [МесяцГод])
                    )
                    ,[Контрагент]
                ) >2 
                and 
                Aggr
                (
                    Avg
                    (
                        Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Контрагент], [МесяцГод])
                    )
                    ,[Контрагент]
                ) <= 4
                , Dual('2-4', 4)
                , If
                (
                    Round
                    (
                        Aggr
                        (
                            Avg
                            (
                                Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Контрагент], [МесяцГод])
                            )
                            ,[Контрагент]
                        )
                    ) = 2
                    , Dual('2', 3)
                    , If
                    (
                        Round
                        (
                            Aggr
                            (
                                Avg
                                (
                                    Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Контрагент], [МесяцГод])
                                )
                                ,[Контрагент]
                            )
                        ) =1
                        , Dual('1', 2)
                        , Dual('<1', 1)
                    )
                )
            )
        )
    )
)
"
dim_СрЧастотаСделокПоГодам;"
If
(
    Aggr
    (
        Avg
        (
            Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Год], [МесяцГод], [Контрагент])
        )
        ,[Год], [Контрагент]
    ) >10
    , Dual('10+', 7)
    , If
    (
        Aggr
        (
            Avg
            (
                Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Год], [МесяцГод], [Контрагент])
            )
            ,[Год], [Контрагент]
        ) >8 
        and 
        Aggr
        (
            Avg
            (
                Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Год], [МесяцГод], [Контрагент])
            )
            ,[Год], [Контрагент]
        ) <= 10
        , Dual('8-10', 6)
        , If
        (
            Aggr
            (
                Avg
                (
                    Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Год], [МесяцГод], [Контрагент])
                )
                ,[Год], [Контрагент]
            ) >4 
            and 
            Aggr
            (
                Avg
                (
                    Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Год], [МесяцГод], [Контрагент])
                )
                , [Год], [Контрагент]
            ) <= 8
            , Dual('4-8', 5)
            , If
            (
                Aggr
                (
                    Avg
                    (
                        Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Год], [МесяцГод], [Контрагент])
                    )
                    ,[Год], [Контрагент]
                ) >2 
                and 
                Aggr
                (
                    Avg
                    (
                        Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Год], [МесяцГод], [Контрагент])
                    )
                    ,[Год], [Контрагент]
                ) <= 4
                , Dual('2-4', 4)
                , If
                (
                    Round
                    (
                        Aggr
                        (
                            Avg
                            (
                                Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Год], [МесяцГод], [Контрагент])
                            )
                            ,[Год], [Контрагент]
                        )
                    ) =2
                    , Dual('2', 3)
                    , If
                    (
                        Round
                        (
                            Aggr
                            (
                                Avg
                                (
                                    Aggr(Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация]), [Год], [МесяцГод], [Контрагент])
                                )
                                ,[Год], [Контрагент]
                            )
                        ) =1
                        , Dual('1', 2)
                        , Dual('<1', 1)
                    )
                )
            )
        )
    )
)
"
dim_СрЧастотаСделок1;"
If
(
    Aggr
    (
        Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация])
        / 
        Count(Distinct [МесяцГод])
        , [Контрагент]
    ) >10
    , Dual('10+', 7)
    , If
    (
        Aggr
        (
            Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация])
            / 
            Count(Distinct [МесяцГод])
            , [Контрагент]
        ) >8 
        and 
        Aggr
        (
            Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация])
            / 
            Count(Distinct [МесяцГод])
            , [Контрагент]
        ) <= 10
        , Dual('8-10', 6)
        , If
        (
            Aggr
            (
                Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация])
                / 
                Count(Distinct [МесяцГод])
                , [Контрагент]
            ) >4 
            and 
            Aggr
            (
                Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация])
                / 
                Count(Distinct [МесяцГод])
                , [Контрагент]
            ) <= 8
            , Dual('4-8', 5)
            , If
            (
                Aggr
                (
                    Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация])
                    / 
                    Count(Distinct [МесяцГод])
                    , [Контрагент]
                ) >2 
                and 
                Aggr
                (
                    Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация])
                    / 
                    Count(Distinct [МесяцГод])
                    , [Контрагент]
                ) <= 4
                , Dual('2-4', 4)
                , If
                (
                    Round
                    (
                        Aggr
                        (
                            Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация])
                            / 
                            Count(Distinct [МесяцГод])
                            , [Контрагент]
                        )
                    ) =2
                    , Dual('2', 3)
                    , If
                    (
                        Round
                        (
                            Aggr
                            (
                                Count({<$(set_УсловияСреднийЧек)>} Distinct [%Реализация])
                                / 
                                Count(Distinct [МесяцГод])
                                , [Контрагент]
                            )
                        ) =1
                        , Dual('1', 2)
                        , Dual('<1', 1)
                    )
                )
            )
        )
    )
)
"
dim_СрМесячнаяРент;"
If
(
    Aggr($(exp_Наценка), [Контрагент]) 
    / 
    Count(Distinct total [МесяцГод]) 
    >0.1
    , Dual('10%+', 4)
    , If
    (
        Aggr($(exp_Наценка), [Контрагент]) 
        / 
        Count(Distinct total [МесяцГод]) 
        >0.05 
        and 
        Aggr($(exp_Наценка), [Контрагент]) 
        / 
        Count(Distinct total [МесяцГод]) 
        <= 0.1
        , Dual('5%-10%', 3)
        , If
        (
            Aggr($(exp_Наценка), [Контрагент]) 
            / 
            Count(Distinct total [МесяцГод]) 
            >0.01 
            and 
            Aggr($(exp_Наценка), [Контрагент]) 
            / 
            Count(Distinct total [МесяцГод]) 
            <= 0.05
            , Dual('1%-5%', 2)
            , Dual('<1%', 1)
        )
    )
)
"
dim_КатегорияABCПоказатель2;"
Aggr
(
    If
    (
        $(exp_ДоляПоказатель2) <= ($(vПорог_А)/100)
        , 'A'
        , If
        (
            $(exp_ДоляПоказатель2) <= ($(vПорог_В)/100)
            , 'B'
            , 'C'
        )
    )
    , $(exp_Измерение)
)
"
dim_КатегорияABCПоказатель1;"
Aggr
(
    If
    (
        $(exp_ДоляПоказатель1) <= ($(vПорог_А)/100)
        , 'A'
        , If
        (
            $(exp_ДоляПоказатель1) <= ($(vПорог_В)/100)
            , 'B'
            , 'C'
        )
    )
    , $(exp_Измерение)
)
"
dim_ГруппыДнейНаСкладе;"
If
(
    [Дней на складе] < 30
    , Dual('до 30', 1)
    , If
    (
        [Дней на складе] > 29 
        and 
        [Дней на складе] < 61
        , Dual('30 - 60', 2)
        , If
        (
            [Дней на складе] > 60 
            and 
            [Дней на складе] < 91
            , Dual('60 - 90', 3)
            , If
            (
                [Дней на складе] > 90 
                and 
                [Дней на складе] < 121
                , Dual('90 - 120', 4),
                If
                (
                    [Дней на складе] > 120
                    , Dual('120 +', 5)
                )
            )
        )
    )
)
"
dim_НоменклНулевыеПродПоМесяцам;"
If
(
    Aggr
    (
        (
            $(exp_ПроданоЕдиниц) = 0 
            and 
            (Sum({<FMStart = {1}>} Остаток)) > 0
        ) or 
        (
            $(exp_ПроданоЕдиниц) = 0 
            and (Sum({<FMEnd = {1}>} Остаток)) > 0
        )
        , [Номенклатура], [МесяцГод]
    )
    , [Номенклатура]
)
"
dim_ГруппировкаКонтрагентов;"
Replace
(
    Class
    (
        Aggr
        (
            Sum({<$(set_УсловияПродаж)>} [СтоимостьСНДС])
            , [Контрагент]
        )
        , 5000
    )
    , '<= x <', ' - '
)
"